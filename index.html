<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sorpresa üíú</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:#05020f;
  color:white;
  font-family:system-ui;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  height:100vh;
  width:100vw;
}

/* Estrellas: twinkle continuo (duraci√≥n/delay se asignan con JS) */
.star{
  position:absolute;
  width:2px;
  height:2px;
  background:#cfc9ff;
  border-radius:50%;
  opacity:0.2;
  will-change:opacity, transform;
  animation-name:twinkle;
  animation-iteration-count:infinite;
  animation-timing-function:ease-in-out;
}
@keyframes twinkle{
  0%{opacity:0.15; transform:scale(0.85)}
  50%{opacity:1; transform:scale(1.25)}
  100%{opacity:0.15; transform:scale(0.95)}
}

/* luna */
.moon{
  position:absolute;right:5vw;top:5vh;
  width:20vw;height:20vw;border-radius:50%;
  background:radial-gradient(circle,#fff,#bfb8ff);
  box-shadow:0 0 5vw #9f8cff;
}

/* pantalla inicio */
.start{z-index:6;text-align:center;transition:.45s}
.start.fade{opacity:0;pointer-events:none}
.start h1{
  font-size:7vw;
  letter-spacing:2px;
  color:#f3d8ff;
  text-shadow:0 0 1vw #b46cff,0 0 2vw #7a3cff;
  margin-bottom:2vh;
}
.line{
  width:45vw;height:0.5vh;margin:2vh auto 4vh;
  background:linear-gradient(90deg,transparent,#ff6aa8,transparent);
  box-shadow:0 0 0.5vw #ff6aa8;border-radius:10px;
}

/* coraz√≥n inicial */
.heart{
  width:15vw;height:15vw;
  position:relative;
  margin:auto;
  transform:rotate(-45deg);
  background:#a455d6;
  cursor:pointer;
  box-shadow:0 0 2vw #b46cff,0 0 4vw #7a3cff;
  animation:pulse 1.4s infinite;
  transition:opacity 1.2s ease, transform 1.5s ease;
}
.heart.fade{
  opacity:0;
  pointer-events:none;
}
.heart:before,.heart:after{
  content:"";position:absolute;width:100%;height:100%;background:#a455d6;border-radius:50%;
}
.heart:before{top:-50%;left:0}
.heart:after{left:50%;top:0}
.heart i{
  position:absolute;width:25%;height:8%;background:rgba(255,255,255,.75);
  border-radius:50%;top:-5%;left:18%;filter:blur(0.2vw);transform:rotate(25deg);
}
@keyframes pulse{0%,100%{transform:rotate(-45deg) scale(1)}50%{transform:rotate(-45deg) scale(1.08)}}

/* carta */
.letterWrap{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  pointer-events:none;opacity:0;transition:.25s;z-index:7;
}
.letterWrap.show{pointer-events:auto;opacity:1}
.cardArea{
  width:80vw;height:50vw;border-radius:5vw;
  display:flex;align-items:center;justify-content:center;
  background:linear-gradient(180deg,rgba(120,60,150,.14),rgba(18,7,25,.45));
  box-shadow:0 2vw 5vw rgba(180,80,220,.18),0 0 7vw rgba(180,80,220,.06) inset;
  cursor:pointer;
  transition:opacity 2.5s ease,transform 2.5s ease;
}
.cardArea .emoji{font-size:25vw}
.cardArea.fade{opacity:0;transform:scale(.92);pointer-events:none}

/* contador */
.count{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-40%);
  font-size:25vw;font-weight:900;
  color:#d49cff;opacity:0;
  -webkit-text-stroke:0.5vw #f3d8ff;
  text-shadow:0 0 1vw #d49cff,0 0 2vw #b46cff,0 0 5vw #7a3cff;
}

/* t√≠tulo elegante animado */
.title{
  position:absolute;
  top:10%;
  width:100%;
  text-align:center;
  font-family:"Playfair Display",serif;
  font-weight:700;
  font-size:10vw;
  letter-spacing:1vw;
  line-height:1.05;
  background:linear-gradient(180deg,#f3d8ff,#c58cff,#8c45ff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 0.3vw 0 #5b2c82,0 1vw 3vw rgba(190,120,255,.6),0 0 2vw rgba(180,90,255,.8);
  opacity:0;
  transition:.7s;
  animation:floatTitle 3s ease-in-out infinite alternate;
}
.title.show{opacity:1;}
@keyframes floatTitle{0%{transform:translateY(0);}50%{transform:translateY(-2vh);}100%{transform:translateY(0);}}

/* tulipanes */
.flowers{
  position:absolute;
  bottom:0;left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:4vw;
  font-size:12vw;
  opacity:0;
  transition:1.2s;
}
.flowers.show{opacity:1;}
.tulipan{ transform:translateY(50%) scale(0); opacity:0; animation-fill-mode: forwards; display:inline-block;}
.flowers.show .t1{animation:florecer 0.6s forwards .2s, sway 3s ease-in-out infinite;}
.flowers.show .t2{animation:florecer 0.6s forwards .5s, sway 3s ease-in-out infinite;}
.flowers.show .t3{animation:florecer 0.6s forwards .8s, sway 3s ease-in-out infinite;}
.flowers.show .t4{animation:florecer 0.6s forwards 1.1s, sway 3s ease-in-out infinite;}
.flowers.show .t5{animation:florecer 0.6s forwards 1.4s, sway 3s ease-in-out infinite;}
.flowers.show .t6{animation:florecer 0.6s forwards 1.7s, sway 3s ease-in-out infinite;}
@keyframes florecer{0%{transform:translateY(50%) scale(0);opacity:0;}100%{transform:translateY(0) scale(1);opacity:1;}}
@keyframes sway{0%{transform:translateY(0) translateX(0) scale(1)}25%{transform:translateY(-1%) translateX(2%) scale(1.02)}50%{transform:translateY(0)}75%{transform:translateY(-1%) translateX(-2%) scale(1.02)}100%{transform:translateY(0) translateX(0) scale(1)}}

/* cuadro de mensaje central (MAS ALTO) */
.messageBox{
  position:absolute;
  top:55%;
  left:50%;
  transform:translate(-50%,-50%);
  width:70vw;           /* espacio m√°s amplio */
  max-width:980px;
  min-height:14vw;      /* M√ÅS alto */
  padding:3.2vw;
  background:rgba(255,255,255,0.26);
  border-radius:1.2vw;
  text-align:center;
  font-family:"Times New Roman", serif;
  font-size:2.8vw;
  opacity:0;
  transition:opacity 1s ease;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
}
.messageBox.show{opacity:1;}

/* estilos ligeros para la explosi√≥n final (corazones suaves) */
.__finalContainer{ position:fixed; inset:0; pointer-events:none; z-index:9999; }
.__finalSmall{ position:absolute; left:0; top:0; transform-origin:center center; transition: transform 1.1s cubic-bezier(.2,.8,.2,1), opacity 1.2s ease; will-change:transform,opacity; font-size:2.2vw; text-align:center; opacity:0;}
</style>
</head>
<body>

<div class="moon"></div>
<div class="title" id="title">FELIZ<br>CUMPLEA√ëOS<br>CHELY</div>
<div class="count" id="count">3</div>

<!-- tulipanes con emojis -->
<div class="flowers" id="flowers">
  <div class="tulipan t1">üå∑</div>
  <div class="tulipan t2">üå∑</div>
  <div class="tulipan t3">üå∑</div>
  <div class="tulipan t4">üå∑</div>
  <div class="tulipan t5">üå∑</div>
  <div class="tulipan t6">üå∑</div>
</div>

<!-- cuadro con mensaje central -->
<div class="messageBox" id="messageBox">
  "Y si fueras m√≠a <br>
Te llenar√≠a todo el d√≠a de sonrisas<br>
Hasta en mis sue√±os tu boca presumir√≠a<br>
Qui√©n dir√≠a<br>
A d√≥nde llegar√≠a<br>
Y porque fueras m√≠a<br>
Mi alma al diablo yo seguro vender√≠a<br>
Diez mil kil√≥metros descalzo correr√≠a<br>
Todo dar√≠a<br>
Porque fueras m√≠a"<br>
</div>

<div class="letterWrap" id="letterWrap">
  <div class="cardArea" id="cardArea"><div class="emoji">üíå</div></div>
</div>

<div class="start" id="start">
<h1>TOCA PARA ABRIR ü•∞</h1>
<div class="line"></div>
<div class="heart" id="heart"><i></i></div>
</div>

<script>
/* ----------------------------
   STARS ‚Äî crear cielo estrellado (twinkle continuo)
   ----------------------------*/
for(let i=0;i<160;i++){
  const s = document.createElement('div');
  s.className = 'star';
  s.style.left = (Math.random()*100) + 'vw';
  s.style.top  = (Math.random()*100) + 'vh';
  // Duraci√≥n y retardo aleatorio para un parpadeo natural
  const durMs = 1200 + Math.random()*3200; // 1.2s - 4s
  const delayMs = Math.random()*1200;
  s.style.animationDuration = (durMs/1000) + 's';
  s.style.animationDelay = (delayMs/1000) + 's';
  // ligera variaci√≥n de tama√±o
  const px = 0.8 + Math.random()*2.2;
  s.style.width = px + 'px';
  s.style.height = px + 'px';
  document.body.appendChild(s);
}

/* ----------------------------
   Elementos base (NO alterar su l√≥gica)
   ----------------------------*/
const start = document.getElementById('start');
const heart = document.getElementById('heart');
const letterWrap = document.getElementById('letterWrap');
const cardArea = document.getElementById('cardArea');
const count = document.getElementById('count');
const flowers = document.getElementById('flowers');
const title = document.getElementById('title');
const messageBox = document.getElementById('messageBox');

let opened = false;
let finalReady = false;
// running = true while an explosion sequence is in progress
let running = false;

/* ---------- HEART: abrir carta ---------- */
heart.addEventListener('click', (e)=>{
  e.stopPropagation();
  heart.style.animation = 'none';
  // peque√±o reflow para asegurar estilos
  void heart.offsetWidth;
  heart.classList.add('fade');
  start.classList.add('fade');
  // peque√±o tiempo antes de mostrar carta
  setTimeout(()=> letterWrap.classList.add('show'), 160);
});

/* ---------- CARD: cuenta regresiva y mostrar segunda p√°gina ---------- */
cardArea.addEventListener('click', (e)=>{
  e.stopPropagation();
  if(opened) return;
  opened = true;
  cardArea.classList.add('fade');

  // breve 'chispa' con las estrellas (subir opacidad moment√°nea)
  const stars = document.querySelectorAll('.star');
  stars.forEach((st, idx) => {
    setTimeout(()=> { st.style.opacity = '1'; }, idx * 6);
    setTimeout(()=> { st.style.opacity = '0.18'; }, 700 + idx * 6);
  });

  // luego cuenta regresiva
  setTimeout(()=>{
    let n = 3;
    count.style.opacity = 1;
    count.textContent = n;
    const id = setInterval(()=>{
      n--;
      if(n>0){
        count.textContent = n;
      } else {
        clearInterval(id);
        count.style.opacity = 0;
        // mostrar segunda p√°gina
        flowers.classList.add('show');
        title.classList.add('show');
        messageBox.classList.add('show');
        finalReady = true;
      }
    }, 1000);
  }, 900);
});

/* ----------------------------
   √öLTIMA P√ÅGINA ‚Äî coraz√≥n grande hecho de corazones peque√±os,
   palpita (infl√°ndose) 3s y luego explota suavemente (m√°s fluido),
   y se puede reactivar tocando otra vez.
   ----------------------------*/
(function addFinalBehavior(){
  function secondShown(){
    return title.classList.contains('show') && flowers.classList.contains('show') && messageBox.classList.contains('show');
  }

  async function runSequence(){
    // prevent reentry while running
    if(running) return;
    running = true;

    // 1) desvanecer elementos de segunda p√°gina
    [title, flowers, messageBox].forEach(el=>{
      if(!el) return;
      el.style.transition = 'opacity .6s ease, transform .6s ease';
      el.style.opacity = '0';
    });

    // 2) crear contenedor para coraz√≥n grande
    const container = document.createElement('div');
    container.className = '__finalContainer';
    document.body.appendChild(container);

    // 3) crear corazones peque√±os en la ecuaci√≥n del coraz√≥n
    const hearts = [];
    const total = 320; // densidad equilibrada
    const scale = 0.62;
    for(let i=0;i<total;i++){
      const t = (i/total) * Math.PI * 2;
      let x = 16 * Math.pow(Math.sin(t), 3);
      let y = 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
      x *= scale; y *= scale;

      const el = document.createElement('div');
      el.className = '__finalSmall';
      el.textContent = 'üíú';
      el.style.left = `calc(50vw + ${x}vw)`;
      el.style.top  = `calc(50vh - ${y}vh)`;
      el.style.fontSize = (1.3 + Math.random()*1.1) + 'vw';
      el.style.opacity = '0';
      el.style.transform = 'scale(0.92) rotate(0deg)';
      container.appendChild(el);
      hearts.push(el);
    }

    // 4) aparici√≥n suave y escalonada
    hearts.forEach((h, idx)=>{
      setTimeout(()=>{ h.style.opacity='1'; h.style.transform='scale(1) rotate(0deg)'; }, idx * 6);
    });

    // calcular retraso aproximado hasta que la silueta est√© visible
    const appearDelay = Math.min(1100, hearts.length * 6 + 120);

    // 5) PALPITACI√ìN (inflado) 3s
    await new Promise(resolve => {
      setTimeout(()=>{
        if(container.animate){
          container.animate([
            { transform: 'scale(1)' },
            { transform: 'scale(1.08)' },
            { transform: 'scale(1)' },
            { transform: 'scale(1.06)' },
            { transform: 'scale(1)' }
          ], { duration: 3000, iterations: 1, easing: 'ease-in-out' });
        } else {
          container.style.transition = 'transform .6s ease-in-out';
          container.style.transform = 'scale(1.06)';
          setTimeout(()=> container.style.transform = 'scale(1)', 600);
          setTimeout(()=> container.style.transform = 'scale(1.04)', 1200);
          setTimeout(()=> container.style.transform = 'scale(1)', 1800);
          setTimeout(()=> container.style.transform = 'scale(1.02)', 2400);
          setTimeout(()=> container.style.transform = 'scale(1)', 3000);
        }
        setTimeout(resolve, 3000);
      }, appearDelay);
    });

    // 6) "Infl√°ndose" final: quick gentle scale up before explosion (0.45s)
    if(container.animate){
      container.animate([{transform:'scale(1)'},{transform:'scale(1.12)'}], {duration:450, fill:'forwards', easing:'ease-out'});
    } else {
      container.style.transition='transform .45s ease-out';
      container.style.transform='scale(1.12)';
    }
    // short pause to feel the inflation
    await new Promise(r=>setTimeout(r,470));

    // 7) EXPLOSI√ìN: corazones salen suave y no tan r√°pidos ‚Äî duraci√≥n ~1.1s
    hearts.forEach((h, idx)=>{
      const angle = Math.random() * Math.PI * 2;
      // dist moderada para suavidad
      const dist = 22 + Math.random()*46; // vw/vh
      const dx = Math.cos(angle) * dist;
      const dy = Math.sin(angle) * dist;
      const rot = (Math.random()*360 - 180);
      const sc = 0.9 + Math.random()*1.15;

      // transici√≥n m√°s suave y con menor velocidad que antes
      h.style.transition = 'transform 1.1s cubic-bezier(.22,.9,.24,1), opacity 1.6s ease';
      h.style.transform = `translate(${dx}vw, ${dy}vh) rotate(${rot}deg) scale(${sc})`;
      // llevar opacidad a casi invisible de forma fluida
      h.style.opacity = '0';
      // remover tras ~1400ms para limpieza
      setTimeout(()=> { try{ h.remove(); } catch(e){} }, 1400 + idx*4);
    });

    // limpiar contenedor unos 1600ms despu√©s
    setTimeout(()=> { try{ container.remove(); } catch(e){} }, 1600 + hearts.length*4);

    // permitir reactivaci√≥n despu√©s de la secuencia
    // damos un peque√±o tiempo extra antes de permitir re-run para evitar choques
    setTimeout(()=> { running = false; }, 1800);

    // opcional: restablecer segunda p√°gina visibles si deseas (NO lo hacemos para no tocar p√°ginas 1/2)
  } // end runSequence

  // click handler que permite re-ejecuciones mientras la segunda p√°gina siga visible
  function onDocClick(e){
    if(!finalReady) return;
    if(!secondShown()) return; // seguridad
    // si ya hay una secuencia en curso, ignorar
    if(running) return;
    // arrancar
    runSequence();
  }

  function secondShown(){
    return title.classList.contains('show') && flowers.classList.contains('show') && messageBox.classList.contains('show');
  }

  // Escuchador en captura para priorizar esta acci√≥n; no elimina otros listeners
  document.addEventListener('click', onDocClick, true);

})(); // addFinalBehavior()
</script>
</body>
</html>
